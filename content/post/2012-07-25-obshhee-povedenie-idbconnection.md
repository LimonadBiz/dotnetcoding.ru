---
title: 'Общее поведение: IDbConnection'
author: dotnetcoding
type: post
date: 2012-07-24T21:03:04+00:00
url: /coding/obshhee-povedenie-idbconnection.html
description:
  - 'Общее поведение любого объекта подключения — например, возможность открытия подключения, закрытия подключения и определения его текущего состояния — обеспечивается реализацией интерфейса System Data. '
robotsmeta:
  - index,follow
categories:
  - .NET Программирование

---
Общее поведение любого объекта подключения — например, возможность открытия подключения, закрытия подключения и определения его текущего состояния — обеспечивается реализацией интерфейса System Data. <!--more-->IDbConnection. Объект подключения ADO-NET можно рассматривать как нечто, работающее с внешним ресурсом. На самом деле то. с чем работает объект подключения, не является внешним ресурсом; это ресурс, которому сопутствуют издержки в смысле производительности, т.к. подключение к источнику данных является одним из наиболее ресурсоемких действий, которые может выполнить приложение. По этой причине важио, чтобы объект подключения реализовывал интерфейс I Disposable. I Disposable — это стандартный в .NET интерфейс, определяющий метод Dispose, который используется для освобождения выделенных ресурсов — особенно неуправляемых.


  
Метод Dispose выполняет для объекта подключения определенные важные действия по зачистке и подробно рассматривается ниже в данной главе.

Ниже приведен список различных методов, которые должен реализовать программист, пишущий поставщик данных в соответствии с интерфейсом
  
**
  
IDbConnection:**

• BeginTransaction. Для обеспечения целостности данных большинство современных СУБД поддерживают концепцию транзакций. Транзакции определяют неделимые операции, которые выполняются по принципу “все или ничего”. Наиболее распространена функция BeginTransaction, вызываемая для начала транзакции с базой данных. Этот метод перегружается, и один из его перегруженных вариантов позволяет указывать используемый транзакцией уровень изоляции (Isolation Level). Эта транзакция отличается от транзакций, которые реализованы в пространстве имен System. Transact!ons. 

• ChangeDatabase. При подключении к серверу баз данных на этом сервере могут находиться несколько баз данных. Функция ChangeDatabase позволяет переключиться на другую базу данных на том же сервере. Вызов Сnange database менее ресурсоемок, чем использование нового объекта подключения, даже при использовании пула подключений. Но все преимущества ограничены лишь SQL Server, т.к. в нем применяется двухэтапное подключение: сначала к серверу, а затем к запрошенному каталогу, При вызове ChangeDatabase происходит просто переключение в другой каталог.

• Open. Этот метод открывает подключение к базе данных и подготавливает его дли использования. Открытые подключения к базе данных не возвращаются в пул, пока они не будут явно закрыты или освобождены: поэтому важно открывать подключения к базе данных как можно позже, а закрывать как можно раньше.

• С1ose. Это обратная операция: она закрывает открытое подключение к базе данных. При вызове метода Close соответствующее физическое подключение к базе данных готово к возврату в пул. Учтите, что освобождение объекта подключения вызывает внутри себя метод Close, но, кроме того, оно выполняет зачистку информации состояния, оставшейся от объекта подключения — например, строки подключения. Для вас, как для разработчика приложения, это означает, что обаметода Close и Dispose помогают в ведении пула подключений, но закрытое подключение можно открыть снова, а освобожденное подключение нельзя.

• CrcateCommand. Взаимодействие с базой данных осуществляется с помощью объектов Command. Эта объекты позволяют указать текст команды с различными параметрами. Для своего выполнения команда должна знать, с какой базой данных она должна быть выполнена. Метод CreateCommand объекта подключения создает объект Command, который при выполнении будет выполнен с тем объектом подключения, который его создал.
  
А вот список различных свойств, которые нужно реализовать в соответствии с интерфейсом IDbConnection:

• Conned&#187; lonStrinq. Используется для указания различных параметров, которые предоставляют всю информацию, нужную объекту подключения для выполнения подключения к базе данных. Здесь можно указать и другую информацию, управляющую поведением объекта подключения.

• Connect! onTimeout. Поскольку подключение выполняется, по меньшей мере, к файлу, а во многих случаях и к другой машине в сети, то могут возникать проблемы наподобие тайм-аутов, неудачных попыток подключения из-за ошибок в сети или других причин. Свойство CommandTimeouc позволяет указывать количество секунд, после которых объект подключения прекращает ожидание и выдает ошибку. Значение 0 означает бесконечный тайм-аут и не должно применяться. Учтите, что свойство ComrrandTimeout отличается от ConnectlonTimeouC, и в ADO.NET 2.0 CommandTimeout невозможно сконфигурировать на уровне подключения.

• Database. Содержит имя текущей базы данных или базы данных, к которой будет открыто подключеиие.

• Scate. Позволяет объекту подключения указывать свое текущее состояние. Чаще всего встречаются состояния ConnectionState.Open и ConnccCionStaCe.Closed.