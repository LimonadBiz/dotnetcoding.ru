---
title: 'Создание параметризованных команд: DbParameter'
author: dotnetcoding
type: post
date: 2012-06-10T09:39:22+00:00
url: /coding/sozdanie-parametrizovanny-h-komand-dbparameter.html
robotsmeta:
  - index,follow
categories:
  - .NET Программирование

---
Я ленив. Мне не хочется писать новую команду для каждой строки с информацией о клиенте, которая может присутствовать в таблице Customers (Клиенты). <!--more-->К счастью, мой начальник согласен со мной, ведь он не хочет, чтобы я тратил время понапрасну. К еще большему счастью, со мной согласны и большинство СУБД, поскольку они пытаются повысить производительность, кэшируя планы запросов, если они встречают команды с одной и той же повторяющейся структурой, Следовательно, имеет смысл ввести параметризованный запрос для каждой строки Customer (Клиент) таблицы Cust omers. Параметризованные запросы имеют и другие преимущества — например, большую устойчивость к атакам внедрением, меньшими требованиями к литерализаций каждой отдельной кавычки при работе со строковыми параметрами.

Это можно сделать, указав однажды текст команды, а затем применяя параметры для достижения той гибкости, которая необходима для различных строк Customer в одной и той же таблице.

Итак, вместо запроса вроде

Update Customers Set FirstNarre = &#8216;Михаил&#8217; where CustcmerlD = 1 можно написать запрос наподобие

Update Customers Set FirstName = @FirstName where CustumerID=@CustumerID

Такой запрос позволяет указывать значения в специальных параметрах @FirstName и @CustumerID и использовать эту же команду для клиентов, отличных от &#8216;Михаил&#8217;.

Поскольку команда представляется объектом DbCommand. и любому поставщику данных могут понадобиться параметризованные команды, эта однотипность привносится на уровень DbCommand с помощью указания свойства Parameters. Это свойство имеет тип DbParametersColiectior., который представляет собой просто коллекцию объектов DbParameter.

Обратите внимание, что связь между свойствами Parameters объектов SqlCommand и OracleCommand обозначена не обычной стрелкой, а двойной, что означает, что это коллекция, а не отдельный объект. Также видно, что свойство DbCommand. Parameters указывает на DbParametersColection. а свойство SqlCommагdParameters аналогично указывает на коллекцию SqlPararueterCollectior которая содержит один или несколько объектов SqlParaireter. Аналогично, свойство OracleCororr.ana. Parameters указывает на объект типа OracleParemetercollect: or. который представляет собой коллекцию OracieParameter.

Таким образом, у каждого поставщика данных, который должен реализовать объект команды, должно быть свойство Parameters, содержащее переменную типа, наследуемого от класса DbРаrarnete&#8217;sCollection — коллекции обьектов DbParameter.

После выполнения команд по подключению в коде .NET необходимо обеспечить сохранение полученных данных в каком-то объекте. Можно написать собственные бизнес-объекты для представления данных, либо воспользоваться стандартным классом, входящим в состав .NET Framework — DataSet — который выполняет функцию автономного кэша для данных. Давайте кратко рассмотрим структуру и назначение объекта DataSet.