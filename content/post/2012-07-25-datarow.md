---
title: DataRow
author: dotnetcoding
type: post
date: 2012-07-25T10:45:18+00:00
url: /coding/datarow.html
robotsmeta:
  - index,follow
categories:
  - .NET Программирование

---
После создания DataTable и определения столбцов можно приступить к заполнению таблицы данными. При этом в коллекцию DataTable.Rows типа DataRowCoilection добавляются новые объекты DataRow. <!--more-->Чтобы создать в Data&#8217;I able новую строку, необходимо сначала вызвать метод DataTable. NewRow (). который возвращает объект DataRow, удовлетворяющий текущей схеме DataTable. Затем нужно установить значение каждого столбца из DataRow, а затем вызвать метод DataTable.Rows. Add (), передав в качестве его единственного аргумента только что созданный объект DataRow:

> С #
> 
> // Создание нового DataRow с той жо схемок, что и DataTable DataRow tempRow productsTable.NewRowO ;
> 
> // Установка значений столбцов tempRow. Item I &#171;I&#8217;D&#187;] = 1;
> 
> tenlpRowЛt^m^'&#187;Name&#187;,, = &#171;Caterham Seven de Dion“; tempRow.1 ternl&#187;Category&#187;] = 1;
> 
> // Добавление DataRow в DataTable productsTable.Rows.Add(terapRow);
> 
> VB.NET
> 
> ’ Создание нового DataRow с той же схемой, что и DataTable Dim terrpRow As DataRow = producr.sTable .NewRow ()
> 
> &#8216; Установка значений столбцов tempRow,itemCID&#187;) = 1
> 
> tempRorf.iten(&#171;Name&#187;) &#8212; &#171;Caterham Seven do Dion&#187; tempRow.Item(&#171;Category&#187;) = 1 &#8216; Добавление DataRow з DataTacle productsTable.Rows.Add(tempRow)

В этом примере в объект productsTable добавляется одна строка. Вначале создается новый объект DataRow (tempRow) с помощью схемы для DataTable и вызова метода productsTablе .NewRow (). Затем задаются значения для каждого из столбцов, определенных в коллекции productsTable.Columns. И. наконец, вызывается метод productsTable.Rows.Add (). который добавляет новый объект DataRow в коллекцию productsTable .Rows.

> На заметку! Объект DataRow, созданный методом NewRow, еще не подсоединен к DataTable. Другими словами, его свойство RowState равно Detached. Эта строка не входит в таблицу, пока она не будет добавлена в коллекцию Rows с помощью вызова Rows .Add. 

Ограничения
  
В реляционных базах данных целостность данных обеспечивается с помощью ограничений — правил, которые применяются к столбцу или столбцам и определяют действие, выполняемое прн изменении данных в соответствующем столбце строки. В ADO.NET имеются два типа ограничений: ForeignKeyConstraint и UniaueConstidint. Здесь мы лишь кратко остановимся на ограничениях, рассмотрев пару простых примеров, а в главе 10 будет показано, как с помощью этих ограничений и отношений сохранять адекватность автономных данных и их соответствие правилам базы данных.

**ForeignKeyConstraint**

Ограничение D&#8217;oreignKeyConstramt предназначено для обеспечения ссылочной целостности. Кроме того, имеется возможность определения каскадного поведения: когда значение в столбце родительской таблицы изменяется или удаляется, ForeignKeyConstraint определяет, как должна реагировать дочерняя таблица. Например, ссли в родительской таблице удаляется запись, можно указать, что следует удалить и все дочерние записи — либо установить в соответствующих полях дочерних записей пустые или особые значения, которые явно идентифицируют записи без родителей. Это называется каскадным действием, т.к. эффект действия в родительской таблице последовательно влияет на всех ее потомков.

Действие, выполняемое с дочерними объектами, определяется в свойстве ForeignKeyConstraint.DeleteRule н/или ForeignKeyConstraint.UpdateRule и может принимать четыре возможных значения System. Data .Rule.
  
**UniqueConstraint**

Ограничение UniqueConstraint указывает, что значения в столбце или столбцах должны быть уникальными. Этот тип ограничения автоматически накладывается на столбцы первичного ключа, о которых речь пойдет ниже. Если для столбца определено ограничение UniqueConstraint, попытка установить для этого столбца одно и то же значение в двух различных строках возбудит исключение типа System.Data.ConstrairtException.

Ограничение UniqueConstraint: можно наложить и на несколько столбцов. В этом случае установка одних и тех же значений для каждого ограниченного столбца в двух строках одной таблицы также возбудит исключение.

Указание первичного ключа: свойство PrimaryKey

Поскольку классы DdLaSe; и DataTable предназначены для поддержки большинства базовых концепций реляционных баз данных, в DataTabxe может и должен присутствовать первичный ключ (primary key). В DataTabxe первичный ключ определяется как массив объектов DataColumn, которые все вместе обеспечивают уникальность идентификатора для DataRow в DataTable. Чтобы создать первичный ключ, нужно в свойстве PrimaryKey объекта DataTable указать массив объектов DataColumn. При таком определении первичного ключа на массив DataCo] umn автоматически накладывается ограничение UniqueConstraint:

> C#
> 
> // Назначение столбца TD первично ключом productsTable. РппагуХоу =
> 
> new DataColumn[] { proaucrsTable.Columns ; &#171;ID&#187; ] ) ;
> 
> VB.NET
> 
> &#8216; Назначение столбца ID первичным ключом produccsTable. priiraryKey •

New DataColumn() {productsTable.Columns(&#171;ID&#187;);
  
**
  
Динамическое создание DataTable**

Теперь объединим уже имеющиеся у нас обрывки знаний. В следующем примере кода собравшем воедино предыдущие фрагменты, создается объект DataTable. устанавливается его первичный ключ, а затем задаются свойства Autolncremant и ReadOnj у объекта DataColumn. что означает, что для этого столбца не допускается непосредственное редактирование: он автоматически получает значение, увеличенное на I для каждой добавляемой строки. Кроме того, класс DataColumn демонстрирует свойство для указания автоинкрементного столбца, разрешающего только чтение — здесь ото сделано для столбца ID.