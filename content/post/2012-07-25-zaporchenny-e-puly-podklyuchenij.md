---
title: Запорченные пулы подключений
author: dotnetcoding
type: post
date: 2012-07-25T09:37:13+00:00
url: /coding/zaporchenny-e-puly-podklyuchenij.html
robotsmeta:
  - index,follow
categories:
  - .NET Программирование

---
Теперь, познакомившись с преимуществами, которые дают пулы подключений, рассмотрим более сложную задачу, которую могут нам задать пулы подключений.<!--more--> Представьте себе ситуацию, когда приложение уже работает некоторое врем&#8217;-затем подключается по сети к базе данных SQL Server. При этом создаете”-чательно полезный пул подключений на, скажем, 25 подключений. И тут разгильдяй входит в серверное помещение, запинается об провод питания сервера баз данных и нечаянно выдергивает его. Он тут же снова включает вилку в розетку {и надеется, чго никто ничего не заметил). Теперь среда .NET CLR {Common Language Runtime — общеязыковая среда времени выполнения), находящаяся па сервере приложения или web-cepecpe, не может определить, что ее пул подключений запорчен. Но еще хуже то, что при запросе на открытие подключения класс брокера пула подключений просто выдаст вам одно из подключений, т.к. брокер полагает что он передает вам правильное подключение — и не знает, что этого подключения больше нет. Поведение приложения становится непредсказуемым, а, кроме того, возможно, оно будет занимать ценные системные ресурсы в виде непонитных сетевых подключений, которые на самом деле давно мертвы. И пока вы не выполните команду и не получите сообщение об ошибке, перезапущенный SQL Server не будет знать, какое подключение вы использовали до возникновения сбоя литания. А еще хуже то, что возникшая ошибка может случайно указывать на любое из оставшихся 24 подключений ш запорчешюго пула.

В .NET 1.1 единственным способом исправления такой ситуации был перезапуск сервера приложения. Однако в .NET 2.0 для этой цели введены два новых статических метода:

• SqlConnection . ClearFoo- — используется для очистки отдельного пула подключений, который указывается передаваемой в качестве параметра строкой подключения.

• SqlConnection . ClearAllFools — используется для очистки всех существующих пулов подключений.